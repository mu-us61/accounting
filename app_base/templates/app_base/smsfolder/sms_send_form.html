{% extends "admin-pro/src/main/index.html" %} {% comment %} {% extends "base.html" %} {% endcomment %} {% load static %} {% block content %}

<div class="container">
  <div class="row justify-content-center">
    <div class="col-md-6">
      <h1 class="mb-4">SMS Yolla</h1>

      <form method="post" enctype="multipart/form-data" action="{% url 'send_sms' %}">
        {% csrf_token %}
        <div class="mb-3">
          <label for="header" class="form-label">Başlık:</label>
          <input type="text" id="header" name="header" class="form-control" required />
        </div>
        <div class="mb-3">
          <label for="message" class="form-label">Mesaj:</label>
          <textarea id="message" name="message" rows="4" class="form-control" required></textarea>
        </div>
        <div class="mb-3">
          <label for="phone_numbers" class="form-label">Telefon Numaraları Yükle :</label>
          <input type="file" id="phone_numbers" name="file" class="form-control" accept=".xlsx, .xls" required onchange="handleFile(this.files)" />
        </div>
        <button type="submit" class="btn btn-primary">Onay</button>
      </form>
      <div id="excel-preview"></div>
      <div class="container mt-5">
        <h1>Download Excel File</h1>
        <p>Click the button below to download the Excel file:</p>
        <a href="{% url 'download_excel' %}" download class="btn btn-primary">Download Excel</a>
      </div>
      <br />
      <br />
      <p>burada excelde ilk satır "name" olmalı, sonraki satırlar "phonenumber" olmalı, bu şekilde alıyor</p>
      <p>Örnek:</p>
      <br />
      <br />
      <img src="{% static 'Images/excel_ornegi.png' %}" class="img-fluid" alt="Example Image" />
    </div>
  </div>
</div>

{% comment %}
<h1>SMS Yolla</h1>
<form method="post" enctype="multipart/form-data" action="{% url 'send_sms' %}">
  {% csrf_token %}
  <label for="header">Başlık:</label>
  <br />
  <input type="text" id="header" name="header" required />
  <br />
  <label for="message">Mesaj:</label>
  <br />
  <textarea id="message" name="message" rows="4" cols="50" required></textarea>
  <br />
  <label for="phone_numbers">Telefon Numaraları Yükle :</label>
  <br />
  <input type="file" id="phone_numbers" name="file" accept=".xlsx, .xls" required />
  <br />
  <button type="submit">Onay</button>
</form>
<br />
<br />
<p>burada excelde ilk satir "name" olmali sonraki satir "phonenumber" olmali bu sekilde aliyor</p>
<p>ornek</p>
<br />
<br />
<img src="{% static 'Images/excel_ornegi.png' %}" alt="Example Image" /> {% endcomment %}

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js"></script>

<script>
  function handleFile(files) {
    const file = files[0];
    const reader = new FileReader();
    reader.onload = function (e) {
      const data = new Uint8Array(e.target.result);
      const workbook = XLSX.read(data, { type: "array" });
      const sheetName = workbook.SheetNames[0];
      const sheet = workbook.Sheets[sheetName];
      const table = XLSX.utils.sheet_to_json(sheet, { header: 1, raw: false });

      // Generate HTML table with Bootstrap 5 styling
      let html = '<div class="table-responsive"><table class="table table-bordered table-striped">';
      for (let i = 0; i < table.length; i++) {
        html += "<tr>";
        for (let j = 0; j < table[i].length; j++) {
          html += "<td>" + table[i][j] + "</td>";
        }
        html += "</tr>";
      }
      html += "</table></div>";
      document.getElementById("excel-preview").innerHTML = html;
    };
    reader.readAsArrayBuffer(file);
  }
</script>
{% endblock content %}
